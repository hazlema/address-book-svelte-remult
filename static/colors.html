<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Color Selector</title>
	<style>
		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			background: rgb(12, 20, 37);
			color: #f5f7ff;
			font-family: ui-monospace, monospace, system-ui;
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
			padding: 2rem;
		}

		.wrapper {
			max-width: 600px;
			width: 100%;
		}

		h1 {
			margin: 0;
			font-size: 2.2rem;
			text-align: center;
			letter-spacing: 1px;
			margin-bottom: 1rem;
		}

		.subhead {
			margin-bottom: 2rem;
			text-align: center;
			font-size: 0.8rem;
			opacity: 0.8;
		}

		.picker-row {
			margin-top: 1rem;
			display: flex;
			gap: 1rem;
			align-items: center;
			justify-content: center;
		}

		.picker-row input[type='color'] {
			width: 56px;
			height: 56px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
		}

		.input-group {
			flex: 1;
			min-width: 120px;
			display: flex;
			gap: 0.5rem;
		}

		.rgb-input {
			flex: 1;
			padding: 12px 16px;
			border-radius: 12px;
			border: none;
			font-size: 1rem;
			background: #ffffff;
			color: #0f111a;
		}

		.input-btn {
			padding: 12px 16px;
			border: none;
			border-radius: 12px;
			font-size: 1rem;
			cursor: pointer;
			font-weight: 600;
			transition: all 0.2s ease;
		}

		.paste-btn {
			background: #1f3cff;
			color: #fff;
		}

		.paste-btn:hover {
			background: #0f2bcc;
		}

		.clear-btn {
			background: #1f3cff;
			color: #fff;
		}

		.clear-btn:hover {
			background: #0f2bcc;
		}

		.go-btn {
			background: #1f3cff;
			color: #fff;
		}

		.go-btn:hover {
			background: #0f2bcc;
		}

		.sliders {
			margin-top: 1.5rem;
			background: rgba(255, 255, 255, 0.08);
			border-radius: 12px;
			padding: 1.5rem;
		}

		.slider-group {
			display: flex;
			align-items: center;
			gap: 1rem;
			margin-bottom: 1rem;
		}

		.slider-group:last-child {
			margin-bottom: 0;
		}

		.slider-label {
			min-width: 60px;
			font-size: 0.9rem;
			font-weight: 600;
		}

		.slider-input {
			flex: 1;
			height: 6px;
			border-radius: 3px;
			background: rgba(255, 255, 255, 0.2);
			outline: none;
			cursor: pointer;
		}

		.slider-input::-webkit-slider-thumb {
			appearance: none;
			width: 18px;
			height: 18px;
			border-radius: 50%;
			background: #1f3cff;
			cursor: pointer;
		}

		.slider-input::-moz-range-thumb {
			width: 18px;
			height: 18px;
			border-radius: 50%;
			background: #1f3cff;
			border: none;
			cursor: pointer;
		}

		.slider-value {
			min-width: 80px;
			font-size: 0.9rem;
			font-family: ui-monospace, monospace;
			text-align: right;
		}

		.slider-controls {
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.slider-btn {
			width: 24px;
			height: 24px;
			border: none;
			border-radius: 4px;
			background: #1f3cff;
			color: #fff;
			font-size: 0.8rem;
			font-weight: bold;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background 0.2s ease;
		}

		.slider-btn:hover {
			background: #0f2bcc;
		}

		.slider-btn:active {
			background: #0a1f99;
		}

		.values {
			margin-top: 1.5rem;
			display: flex;
			gap: 1rem;
			justify-content: center;
		}

		.value-box {
			flex: 1;
			min-width: 100px;
			background: rgba(255, 255, 255, 0.08);
			border-radius: 12px;
			padding: 12px;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 6px;
			position: relative;
		}

		.value-box .title {
			font-size: 0.75rem;
			text-transform: uppercase;
			letter-spacing: 1px;
			margin-bottom: 4px;
		}

		.code {
			background: #0f111a;
			border-radius: 6px;
			padding: 6px 10px;
			font-family: ui-monospace, monospace;
			display: block;
			overflow-wrap: anywhere;
			font-size: 0.9rem;
		}

		.copy-btn {
			margin-top: 4px;
			padding: 6px 12px;
			border: none;
			border-radius: 8px;
			background: #1f3cff;
			color: #fff;
			cursor: pointer;
			font-size: 0.75rem;
		}

		.copy-btn:focus {
			outline: 2px solid #00ffcc;
			outline-offset: 2px;
		}

		.swatch {
			margin: 1.5rem auto;
			border-radius: 12px;
			width: 100%;
			height: 140px;
			background: #5c7cff;
			border: 3px solid rgba(255, 255, 255, 0.15);
			transition: border-color 0.3s ease;
		}

		.swatch.changed {
			border-color: #00ffcc;
		}

		.lightness-buttons {
			margin-top: 1rem;
			display: flex;
			gap: 1rem;
			justify-content: center;
		}

		.lightness-btn {
			padding: 8px 16px;
			border: none;
			border-radius: 8px;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.darken-btn {
			background: #2c3e50;
			color: #fff;
		}

		.darken-btn:hover {
			background: #34495e;
		}

		.lighten-btn {
			background: #ecf0f1;
			color: #2c3e50;
		}

		.lighten-btn:hover {
			background: #bdc3c7;
		}

		.background-control {
			margin-top: 1.5rem;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 1rem;
			padding: 1rem;
			background: rgba(255, 255, 255, 0.05);
			border-radius: 12px;
			border: 1px solid rgba(255, 255, 255, 0.1);
		}

		.background-label {
			font-size: 0.9rem;
			font-weight: 600;
			color: #f5f7ff;
		}

		.background-picker {
			width: 40px;
			height: 40px;
			border: 2px solid rgba(255, 255, 255, 0.5);
			border-radius: 8px;
			cursor: pointer;
			background: #ffffff;
			padding: 0;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
		}

		.footer {
			margin-top: 1rem;
			text-align: center;
			font-size: 0.65rem;
			opacity: 0.8;
		}

		.toast {
			position: fixed;
			top: 16px;
			right: 16px;
			background: #00ffcc;
			color: #0f111a;
			padding: 10px 16px;
			border-radius: 999px;
			font-weight: 600;
			box-shadow: 0 15px 35px -5px rgba(0, 255, 204, 0.6);
			transition: opacity 0.4s ease-in-out;
			opacity: 1;
		}

		.toast.fade-out {
			opacity: 0;
		}

		.picker-row input[type='color']:focus,
		.input-btn:focus {
			outline: 2px solid #00ffcc;
			outline-offset: 2px;
		}
	</style>
</head>

<body>
	<div class="wrapper">
		<h1>Color Convert & Select</h1>
		<div class="subhead">
			Select or paste any RGB, HEX, HSV, or OKLCh string in the textbox to see conversions.
		</div>
		<div class="picker-row">
			<input type="color" id="colorPicker" value="#5c7cff" aria-label="Color picker" eye-dropper />
			<div class="input-group">
				<input type="text" id="rgbInput" class="rgb-input" placeholder="rgb(r, g, b)"
					aria-label="RGB, HSV, or OKLCh color input" value="rgb(92, 124, 255)" />
				<button class="input-btn paste-btn" id="pasteBtn" title="Paste from clipboard"
					aria-label="Paste from clipboard">
					üìã
				</button>
				<button class="input-btn clear-btn" id="clearBtn" title="Clear input" aria-label="Clear input">
					üóëÔ∏è
				</button>
				<button class="input-btn go-btn" id="goBtn" title="Parse color" aria-label="Parse color">
					‚ñ∂Ô∏è
				</button>
			</div>
		</div>
		<div class="swatch" id="swatch"></div>
		<div class="lightness-buttons">
			<button class="lightness-btn darken-btn" id="darkenBtn">Darken Slightly</button>
			<button class="lightness-btn lighten-btn" id="lightenBtn">Lighten Slightly</button>
		</div>
		<div class="sliders">
			<div class="slider-group">
				<div class="slider-label">Luma</div>
				<input type="range" id="lumaSlider" class="slider-input" min="0" max="100" step="0.1" value="54.7" />
				<div class="slider-controls">
					<div class="slider-value" id="lumaValue">54.7%</div>
					<button class="slider-btn" id="lumaMinus">‚àí</button>
					<button class="slider-btn" id="lumaPlus">+</button>
				</div>
			</div>
			<div class="slider-group">
				<div class="slider-label">Chroma</div>
				<input type="range" id="chromaSlider" class="slider-input" min="0" max="0.4" step="0.001"
					value="0.511" />
				<div class="slider-controls">
					<div class="slider-value" id="chromaValue">0.511</div>
					<button class="slider-btn" id="chromaMinus">‚àí</button>
					<button class="slider-btn" id="chromaPlus">+</button>
				</div>
			</div>
			<div class="slider-group">
				<div class="slider-label">Hue</div>
				<input type="range" id="hueSlider" class="slider-input" min="0" max="360" step="1" value="207" />
				<div class="slider-controls">
					<div class="slider-value" id="hueValue">207¬∞</div>
					<button class="slider-btn" id="hueMinus">‚àí</button>
					<button class="slider-btn" id="huePlus">+</button>
				</div>
			</div>
		</div>
		<div class="values">
			<div class="value-box">
				<div class="title">RGB</div>
				<div class="code" id="rgbCode">rgb(92, 124, 255)</div>
				<button class="copy-btn" data-copy-target="#rgbCode" aria-label="Copy RGB value">
					Copy
				</button>
			</div>
			<div class="value-box">
				<div class="title">HSV</div>
				<div class="code" id="hsvCode">hsv(228, 64%, 100%)</div>
				<button class="copy-btn" data-copy-target="#hsvCode" aria-label="Copy HSV value">
					Copy
				</button>
			</div>
			<div class="value-box">
				<div class="title">OKLCh</div>
				<div class="code" id="oklchCode">oklch(54.7%, 0.511, 207)</div>
				<button class="copy-btn" data-copy-target="#oklchCode" aria-label="Copy OKLCh value">
					Copy
				</button>
			</div>
		</div>
		<div class="background-control">
			<div class="background-label">Change Page Background</div>
			<input type="color" id="backgroundPicker" class="background-picker" value="#0c1425" aria-label="Page background color picker" eye-dropper />
			<button id="resetBackground" style="padding: 8px 12px; background: #1f3cff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">Reset</button>
		</div>
	</div>
	<div id="toast-container"></div>
	<script>
		// Displays a toast notification with a message
		function showToast(msg) {
			const t = document.createElement('div');
			t.className = 'toast';
			t.textContent = msg;
			document.getElementById('toast-container').appendChild(t);
			setTimeout(() => t.classList.add('fade-out'), 1400);
			setTimeout(() => t.remove(), 1800);
		}

		// Copies text to clipboard and shows toast feedback
		function copyText(str) {
			navigator.clipboard
				.writeText(str)
				.then(() => showToast('Copied!'))
				.catch(() => showToast('Copy failed!'));
		}

		// Handles copy button clicks
		document.body.addEventListener('click', (e) => {
			const btn = e.target.closest('[data-copy-target]');
			if (!btn) return;
			const sel = btn.getAttribute('data-copy-target');
			const el = document.querySelector(sel);
			if (el) copyText(el.textContent.trim());
		});

		// Debounces a function to limit execution rate
		function debounce(fn, ms) {
			let timeout;
			return (...args) => {
				clearTimeout(timeout);
				timeout = setTimeout(() => fn(...args), ms);
			};
		}

		// Normalizes hex color input (adds #, expands 3-digit to 6-digit)
		function clampHex(h) {
			if (!h.startsWith('#')) h = '#' + h;
			if (h.length === 4) h = '#' + h[1] + h[1] + h[2] + h[2] + h[3] + h[3];
			return h;
		}

		// Converts hex color to RGB values
		function hexToRgb(hex) {
			hex = clampHex(hex.replace(/[^0-9a-fA-F]/g, ''));
			const bigint = parseInt(hex.slice(1), 16);
			return [(bigint >> 16) & 255, (bigint >> 8) & 255, bigint & 255];
		}

		// Converts RGB to HSV color space
		function rgbToHsv(r, g, b) {
			r /= 255;
			g /= 255;
			b /= 255;
			const max = Math.max(r, g, b),
				min = Math.min(r, g, b),
				d = max - min;
			let h = 0;
			if (d) {
				if (max === r) h = ((g - b) / d) % 6;
				else if (max === g) h = (b - r) / d + 2;
				else h = (r - g) / d + 4;
				h *= 60;
				if (h < 0) h += 360;
			}
			const s = max ? d / max : 0;
			const v = max;
			return [Math.round(h), Math.round(s * 100), Math.round(v * 100)];
		}

		// Converts HSV to RGB color space
		function hsvToRgb(h, s, v) {
			s /= 100;
			v /= 100;
			const c = v * s;
			const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
			const m = v - c;
			let r, g, b;
			if (h >= 0 && h < 60) [r, g, b] = [c, x, 0];
			else if (h < 120) [r, g, b] = [x, c, 0];
			else if (h < 180) [r, g, b] = [0, c, x];
			else if (h < 240) [r, g, b] = [0, x, c];
			else if (h < 300) [r, g, b] = [x, 0, c];
			else[r, g, b] = [c, 0, x];
			return [
				Math.round((r + m) * 255),
				Math.round((g + m) * 255),
				Math.round((b + m) * 255),
			];
		}

		// Converts sRGB to linear sRGB for OKLab calculation
		function sRGBtoLinear(c) {
			c = c / 255;
			return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
		}

		// Converts linear sRGB to OKLab color space
		function linearSrgbToOklab(R, G, B) {
			const l_ = 0.8189330101 * R + 0.3618667424 * G - 0.1288597137 * B;
			const m_ = 0.0329845436 * R + 0.9293118715 * G + 0.0361456387 * B;
			const s_ = 0.0482003018 * R + 0.2643662691 * G + 0.633851707 * B;
			const l = Math.cbrt(l_);
			const m = Math.cbrt(m_);
			const s = Math.cbrt(s_);
			const L = 0.2104542553 * l + 0.793617785 * m - 0.0040720468 * s;
			const a = 1.9779984951 * l - 2.428592205 * m + 0.4505937099 * s;
			const b = 0.0259040371 * l + 0.7827717662 * m - 0.808675766 * s;
			return [L, a, b];
		}

		// Converts OKLab to OKLCh (Lightness, Chroma, Hue)
		function oklabToOklch(L, a, b) {
			const C = Math.hypot(a, b);
			let h = (Math.atan2(b, a) * 180) / Math.PI;
			if (h < 0) h += 360;
			return [L, C, h];
		}

		// Converts OKLCh to OKLab
		function oklchToOklab(L, C, h) {
			const a = C * Math.cos((h * Math.PI) / 180);
			const b = C * Math.sin((h * Math.PI) / 180);
			return [L, a, b];
		}

		// Converts OKLab to linear sRGB
		function oklabToLinearSrgb(L, a, b) {
			const l = Math.pow(L + 0.3963377774 * a + 0.2158037573 * b, 3);
			const m = Math.pow(L - 0.1055613458 * a - 0.0638541728 * b, 3);
			const s = Math.pow(L - 0.0894841775 * a - 1.291485548 * b, 3);
			const R = 4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s;
			const G = -1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s;
			const B = -0.0041960863 * l - 0.7034186147 * m + 1.707614701 * s;
			return [R, G, B];
		}

		// Converts linear sRGB to sRGB
		function linearToSrgb(c) {
			return c <= 0.0031308 ? 12.92 * c : 1.055 * Math.pow(c, 1 / 2.4) - 0.055;
		}

		// Converts OKLCh to RGB
		function oklchToRgb(L, C, h) {
			const [okL, a, b] = oklchToOklab(L, C, h);
			const [R, G, B] = oklabToLinearSrgb(okL, a, b);
			return [
				Math.round(Math.min(255, Math.max(0, linearToSrgb(R) * 255))),
				Math.round(Math.min(255, Math.max(0, linearToSrgb(G) * 255))),
				Math.round(Math.min(255, Math.max(0, linearToSrgb(B) * 255))),
			];
		}

		// Updates sliders from OKLCh values
		function updateSlidersFromOklch(L, C, h) {
			document.getElementById('lumaSlider').value = L * 100;
			document.getElementById('chromaSlider').value = C;
			document.getElementById('hueSlider').value = h;
			document.getElementById('lumaValue').textContent = (L * 100).toFixed(1) + '%';
			document.getElementById('chromaValue').textContent = C.toFixed(3);
			document.getElementById('hueValue').textContent = h.toFixed(0) + '¬∞';
		}

		// Flag to prevent feedback loops
		let isUpdatingFromSlider = false;

		// Adjusts lightness by a small amount
		function adjustLightness(direction) {
			const currentLuma = parseFloat(document.getElementById('lumaSlider').value) / 100;
			const chroma = parseFloat(document.getElementById('chromaSlider').value);
			const hue = parseFloat(document.getElementById('hueSlider').value);
			// Adjust lightness by 5% (0.05 in OKLCh space)
			const adjustment = direction === 'darken' ? -0.01 : 0.01;
			const newLuma = Math.max(0, Math.min(1, currentLuma + adjustment));
			// Update slider and trigger update
			document.getElementById('lumaSlider').value = newLuma * 100;
			updateFromSliders();
		}

		// Fine-tune slider values with +/- buttons
		function adjustSlider(sliderId, direction) {
			const slider = document.getElementById(sliderId);
			const currentValue = parseFloat(slider.value);
			const step = parseFloat(slider.step);
			const min = parseFloat(slider.min);
			const max = parseFloat(slider.max);
			const adjustment = direction === 'minus' ? -step : step;
			const newValue = Math.max(min, Math.min(max, currentValue + adjustment));
			slider.value = newValue;
			updateFromSliders();
		}

		// Updates color from slider values
		function updateFromSliders() {
			if (isUpdatingFromSlider) return;
			isUpdatingFromSlider = true;
			const luma = parseFloat(document.getElementById('lumaSlider').value) / 100;
			const chroma = parseFloat(document.getElementById('chromaSlider').value);
			const hue = parseFloat(document.getElementById('hueSlider').value);
			// Update the slider value displays
			document.getElementById('lumaValue').textContent = (luma * 100).toFixed(1) + '%';
			document.getElementById('chromaValue').textContent = chroma.toFixed(3);
			document.getElementById('hueValue').textContent = hue.toFixed(0) + '¬∞';
			try {
				const [r, g, b] = oklchToRgb(luma, chroma, hue);
				updateFromSlidersOnly(r, g, b);
				// Update the input field with the new OKLCh value
				document.getElementById('rgbInput').value = `oklch(${(luma * 100).toFixed(1)}%, ${chroma.toFixed(3)}, ${hue.toFixed(0)})`;
			} catch (e) {
				// Handle out-of-gamut colors gracefully
				showToast('Color out of gamut!');
			}
			isUpdatingFromSlider = false;
		}

		// Updates UI without affecting sliders (for slider updates)
		function updateFromSlidersOnly(r, g, b) {
			const hex = '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toLowerCase();
			const swatch = document.getElementById('swatch');
			swatch.style.background = hex;
			swatch.classList.add('changed');
			setTimeout(() => swatch.classList.remove('changed'), 300);
			document.getElementById('rgbCode').textContent = `rgb(${r}, ${g}, ${b})`;
			const [h, s, v] = rgbToHsv(r, g, b);
			document.getElementById('hsvCode').textContent = `hsv(${h}, ${s}%, ${v}%)`;
			const R = sRGBtoLinear(r);
			const G = sRGBtoLinear(g);
			const B = sRGBtoLinear(b);
			const [okL, oka, okb] = linearSrgbToOklab(R, G, B);
			let [L, C, H] = oklabToOklch(okL, oka, okb);
			if (L > 0.999 || L < 0.001) {
				L = Math.round(L);
				C = 0;
				H = 0;
			} else {
				L = Math.min(1, Math.max(0, L));
			}
			document.getElementById('oklchCode').textContent = `oklch(${(L * 100).toFixed(1)}%, ${C.toFixed(3)}, ${H.toFixed(0)})`;
			document.getElementById('colorPicker').value = hex;
		}

		// Updates UI with color values
		function update(r, g, b) {
			const hex = '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toLowerCase();
			const swatch = document.getElementById('swatch');
			swatch.style.background = hex;
			swatch.classList.add('changed');
			setTimeout(() => swatch.classList.remove('changed'), 300);
			document.getElementById('rgbCode').textContent = `rgb(${r}, ${g}, ${b})`;
			document.getElementById('rgbInput').value = `rgb(${r}, ${g}, ${b})`;
			const [h, s, v] = rgbToHsv(r, g, b);
			document.getElementById('hsvCode').textContent = `hsv(${h}, ${s}%, ${v}%)`;
			const R = sRGBtoLinear(r);
			const G = sRGBtoLinear(g);
			const B = sRGBtoLinear(b);
			const [okL, oka, okb] = linearSrgbToOklab(R, G, B);
			let [L, C, H] = oklabToOklch(okL, oka, okb);
			if (L > 0.999 || L < 0.001) {
				L = Math.round(L);
				C = 0;
				H = 0;
			} else {
				L = Math.min(1, Math.max(0, L));
			}
			document.getElementById('oklchCode').textContent = `oklch(${(L * 100).toFixed(1)}%, ${C.toFixed(3)}, ${H.toFixed(0)})`;
			document.getElementById('colorPicker').value = hex;
			// Update sliders only if not currently updating from sliders
			if (!isUpdatingFromSlider) {
				updateSlidersFromOklch(L, C, H);
			}
		}

		// Sets color from hex input
		function setColorFromHex(hex) {
			try {
				const [r, g, b] = hexToRgb(hex);
				update(r, g, b);
			} catch (e) {
				showToast('Invalid hex color!');
			}
		}

		// Parses and sets color from input string (RGB, HSV, or OKLCh)
		function setColorFromInput(input) {
			try {
				input = input.trim().toLowerCase();
				let r, g, b;
				// Helper to extract numbers from input
				function extractNumbers(str, expectedCount, format) {
					// Remove everything except numbers, decimals, and % signs
					const cleaned = str.replace(/[^0-9.%]/g, ' ');
					// Split by spaces and filter out empty strings
					const values = cleaned.split(/\s+/).filter((v) => v !== '');
					if (values.length !== expectedCount) {
						throw new Error(
							`Invalid ${format} format: Expected ${expectedCount} values, got ${values.length}`,
						);
					}
					return values.map((v) => (v.includes('%') ? parseFloat(v) / 100 : parseFloat(v)));
				}
				// Parse RGB: rgb(r, g, b)
				if (input.startsWith('rgb(')) {
					const values = extractNumbers(input, 3, 'RGB');
					[r, g, b] = values.map(Math.round);
					if (r > 255 || g > 255 || b > 255 || r < 0 || g < 0 || b < 0) {
						throw new Error('RGB values out of range (0-255)');
					}
				}
				// Parse HSV: hsv(h, s%, v%)
				else if (input.startsWith('hsv(')) {
					const values = extractNumbers(input, 3, 'HSV');
					const [h, s, v] = values;
					if (h > 360 || s > 1 || v > 1 || h < 0 || s < 0 || v < 0) {
						throw new Error('HSV values out of range (h: 0-360, s/v: 0-100%)');
					}
					[r, g, b] = hsvToRgb(h, s * 100, v * 100);
				}
				// Parse Hex
				else if (input.startsWith('#') || /^[0-9a-fA-F]{3,6}$/.test(input)) {
					setColorFromHex(input);
					return;
				}
				// Parse OKLCh: oklch(l%, c, h)
				else if (input.startsWith('oklch(')) {
					const values = extractNumbers(input, 3, 'OKLCh');
					const [l, c, h] = values;
					if (l > 1 || l < 0 || c < 0 || h > 360 || h < 0) {
						throw new Error('OKLCh values out of range (l: 0-100%, c: ‚â•0, h: 0-360)');
					}
					[r, g, b] = oklchToRgb(l, c, h);
				} else {
					throw new Error('Unrecognized color format');
				}
				update(r, g, b);
			} catch (e) {
				showToast(e.message);
			}
		}

		// Event listeners
		document
			.getElementById('colorPicker')
			.addEventListener('input', (e) => {
				const color = e.target.value;
				if (color && color !== 'rgba(0, 0, 0, 0)') {
					// Handle both hex and rgba formats
					if (color.startsWith('rgba(')) {
						// Convert rgba to hex
						const rgba = color.match(/rgba?\(([^)]+)\)/);
						if (rgba) {
							const values = rgba[1].split(',').map(v => parseFloat(v.trim()));
							const [r, g, b] = values;
							const hex = '#' + ((1 << 24) + (Math.round(r) << 16) + (Math.round(g) << 8) + Math.round(b)).toString(16).slice(1);
							setColorFromHex(hex);
						}
					} else {
						setColorFromHex(color);
					}
				}
			});

		// Add eyedropper for main color picker (works when hosted)
		document.getElementById('colorPicker').addEventListener('click', async (e) => {
			if (e.altKey) { // Alt+click to use eyedropper
				e.preventDefault();
				try {
					const eyeDropper = new EyeDropper();
					const result = await eyeDropper.open();
					setColorFromHex(result.sRGBHex);
				} catch (err) {
					// Eyedropper may not work locally
				}
			}
		});

		// Paste button
		document.getElementById('pasteBtn').addEventListener('click', async () => {
			try {
				const text = await navigator.clipboard.readText();
				document.getElementById('rgbInput').value = text;
				showToast('Pasted from clipboard!');
			} catch (e) {
				showToast('Failed to read clipboard!');
			}
		});

		// Clear button
		document.getElementById('clearBtn').addEventListener('click', () => {
			document.getElementById('rgbInput').value = '';
			showToast('Input cleared!');
		});

		// Go button
		document.getElementById('goBtn').addEventListener('click', () => {
			const input = document.getElementById('rgbInput').value;
			if (input.trim()) {
				setColorFromInput(input);
			} else {
				showToast('Please enter a color value!');
			}
		});

		// Enter key still works for convenience
		document.getElementById('rgbInput').addEventListener('keypress', (e) => {
			if (e.key === 'Enter') {
				document.getElementById('goBtn').click();
			}
		});

		// Slider event listeners
		document.getElementById('lumaSlider').addEventListener('input', updateFromSliders);
		document.getElementById('chromaSlider').addEventListener('input', updateFromSliders);
		document.getElementById('hueSlider').addEventListener('input', updateFromSliders);

		// Lightness adjustment buttons
		document.getElementById('darkenBtn').addEventListener('click', () => adjustLightness('darken'));
		document.getElementById('lightenBtn').addEventListener('click', () => adjustLightness('lighten'));

					// Slider fine-tuning buttons
			document.getElementById('lumaMinus').addEventListener('click', () => adjustSlider('lumaSlider', 'minus'));
			document.getElementById('lumaPlus').addEventListener('click', () => adjustSlider('lumaSlider', 'plus'));
			document.getElementById('chromaMinus').addEventListener('click', () => adjustSlider('chromaSlider', 'minus'));
			document.getElementById('chromaPlus').addEventListener('click', () => adjustSlider('chromaSlider', 'plus'));
			document.getElementById('hueMinus').addEventListener('click', () => adjustSlider('hueSlider', 'minus'));
			document.getElementById('huePlus').addEventListener('click', () => adjustSlider('hueSlider', 'plus'));

			// Background color picker
			document.getElementById('backgroundPicker').addEventListener('input', (e) => {
				const color = e.target.value;
				if (color && color !== 'rgba(0, 0, 0, 0)') {
					// Handle both hex and rgba formats
					if (color.startsWith('rgba(')) {
						// Convert rgba to hex
						const rgba = color.match(/rgba?\(([^)]+)\)/);
						if (rgba) {
							const values = rgba[1].split(',').map(v => parseFloat(v.trim()));
							const [r, g, b] = values;
							const hex = '#' + ((1 << 24) + (Math.round(r) << 16) + (Math.round(g) << 8) + Math.round(b)).toString(16).slice(1);
							document.body.style.background = hex;
						}
					} else {
						document.body.style.background = color;
					}
				}
			});

			// Add eyedropper for background picker (works when hosted)
			document.getElementById('backgroundPicker').addEventListener('click', async (e) => {
				if (e.altKey) { // Alt+click to use eyedropper
					e.preventDefault();
					try {
						const eyeDropper = new EyeDropper();
						const result = await eyeDropper.open();
						document.body.style.background = result.sRGBHex;
						document.getElementById('backgroundPicker').value = result.sRGBHex;
					} catch (err) {
						// Eyedropper may not work locally
					}
				}
			});

			// Reset background button
			document.getElementById('resetBackground').addEventListener('click', () => {
				document.body.style.background = '#0c1425';
				document.getElementById('backgroundPicker').value = '#0c1425';
			});

		// Initialize with default color
		setColorFromHex(document.getElementById('colorPicker').value);	</script>
</body>

</html>